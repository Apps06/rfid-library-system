{% extends 'labs/base.html' %}

{% block title %}Dashboard - Labs{% endblock %}
{% block page_title %}Labs Dashboard{% endblock %}

{% block content %}
<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card labs">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-value" id="inside-count">-</div>
        <div class="stat-label">In Lab Now</div>
    </div>
    <div class="stat-card labs">
        <div class="stat-icon">ğŸ”§</div>
        <div class="stat-value" id="total-apparatus">-</div>
        <div class="stat-label">Total Equipment</div>
    </div>
    <div class="stat-card labs">
        <div class="stat-icon">ğŸ“‹</div>
        <div class="stat-value" id="borrowed-count">-</div>
        <div class="stat-label">Items Borrowed</div>
    </div>
    <div class="stat-card" style="--accent-color: #ef4444;">
        <div class="stat-icon">âš ï¸</div>
        <div class="stat-value text-danger" id="pending-fines">â‚¹0</div>
        <div class="stat-label">Damage Fines</div>
    </div>
</div>

<!-- Recent Activity -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">ğŸ“‹ Recent Lab Activity</h2>
        <span class="text-muted" id="last-update">Updating...</span>
    </div>

    <div class="activity-list" id="activity-list">
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ”¬</div>
            <div class="empty-state-title">No recent activity</div>
            <p>Lab attendance and equipment borrows will appear here</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function loadLabsStats() {
        const data = await API.get('/labs/stats');
        if (!data || !data.success) return;

        document.getElementById('inside-count').textContent = data.stats.inside_count;
        document.getElementById('total-apparatus').textContent = data.stats.total_apparatus;
        document.getElementById('borrowed-count').textContent = data.stats.borrowed_count;
        document.getElementById('pending-fines').textContent = 'â‚¹' + data.stats.pending_fines;
        document.getElementById('last-update').textContent = 'Updated: ' + new Date().toLocaleTimeString();

        // Render recent activity
        const activityList = document.getElementById('activity-list');

        if (!data.recent_activity || data.recent_activity.length === 0) {
            activityList.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ”¬</div>
                <div class="empty-state-title">No recent activity</div>
                <p>Lab attendance and equipment borrows will appear here</p>
            </div>
        `;
            return;
        }

        activityList.innerHTML = data.recent_activity.map(item => `
        <div class="activity-item">
            <div class="activity-badge ${item.return_date ? 'exit' : 'entry'}">
                ${item.return_date ? 'â†' : 'â†’'}
            </div>
            <div class="activity-info">
                <div class="activity-name">${item.apparatus_name}</div>
                <div class="activity-roll">${item.student_name}</div>
            </div>
            <div class="activity-time">
                <div class="activity-action ${item.return_date ? 'exit' : 'entry'}">
                    ${item.return_date ? 'RETURNED' : 'BORROWED'}
                    ${item.is_damaged ? '<span class="damaged-badge">DAMAGED</span>' : ''}
                </div>
                <div>${formatDate(item.borrow_date)}</div>
            </div>
        </div>
    `).join('');
    }

    loadLabsStats();
    setInterval(loadLabsStats, 10000);
</script>
{% endblock %}